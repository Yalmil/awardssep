<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chatbot - Yalmil.com</title>

  <link rel="icon" href="https://cdn.discordapp.com/emojis/1416607460201857168.png?v=1" type="image/png">
  <meta property="og:title" content="Yalmil.com" />
  <meta property="og:description" content="Chatbot inteligente con respuestas autom√°ticas y APIs integradas" />
  <meta property="og:image" content="https://cdn.discordapp.com/attachments/1355008732576088204/1402309070014124102/Screenshot_20250804-221210.png?ex=68937197&is=68922017&hm=1fa6f462304b2b8cf8a0875053730f988d725d114fbf2648fcb87ee1b67b6a76&" />
  <meta property="og:url" content="https://yalmil.github.io/Yalmil.com/" />
  <meta property="og:type" content="website" />

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0a0a0a, #1a001f);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: #e5ccff;
    }

    .container {
      width: 100%;
      max-width: 600px;
      height: 600px;
      background: rgba(20, 0, 40, 0.8);
      border-radius: 16px;
      box-shadow: 0 0 20px #c084fc44;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      backdrop-filter: blur(8px);
      border: 1px solid rgba(192, 132, 252, 0.3);
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      text-shadow: 0 0 10px #c084fc;
    }

    .chatbox {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      scroll-behavior: smooth;
    }

    .message {
      display: flex;
      margin-bottom: 12px;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .user-message { justify-content: flex-end; }

    .user-message .text {
      background: #667eea;
      color: white;
      padding: 10px 15px;
      border-radius: 18px;
      max-width: 70%;
      border-bottom-right-radius: 4px;
    }

    .bot-message .text {
      background: rgba(102, 126, 234, 0.15);
      border: 1px solid rgba(118, 75, 162, 0.3);
      color: #fff;
      padding: 10px 15px;
      border-radius: 18px;
      max-width: 70%;
      border-bottom-left-radius: 4px;
      backdrop-filter: blur(6px);
    }

    .error-message .text {
      background: #ffebee;
      color: #c62828;
      padding: 10px 15px;
      border-radius: 18px;
      max-width: 70%;
      border-bottom-left-radius: 4px;
    }

    .input-area {
      display: flex;
      padding: 15px;
      background: rgba(20, 0, 40, 0.6);
      border-top: 1px solid #c084fc33;
      gap: 10px;
    }

    input[type="text"] {
      flex: 1;
      padding: 12px 15px;
      border: 2px solid #c084fc44;
      border-radius: 24px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      font-size: 14px;
      outline: none;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus {
      border-color: #c084fc;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 24px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s;
    }

    button:hover { transform: scale(1.05); }
    button:active { transform: scale(0.95); }

    .loading {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 480px) {
      .container { height: 90vh; }
      .header { font-size: 20px; }
      input[type="text"] { font-size: 16px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">üêà‚Äç‚¨õ YLMIA</div>
    <div class="chatbox" id="chatbox"></div>
    <div class="input-area">
      <input type="text" id="userInput" placeholder="Escribe tu pregunta..." autocomplete="off">
      <button id="sendButton">Enviar</button>
    </div>
  </div>

  <script>
    let respuestasData = {};

    async function cargarRespuestas() {
      try {
        const response = await fetch('respuestas.txt');
        if (!response.ok) throw new Error('No se pudo cargar respuestas.txt');
        const text = await response.text();
        respuestasData = parseRespuestas(text);
      } catch {
        respuestasData = {};
      }
    }

    function parseRespuestas(texto) {
      const datos = {};
      const bloques = texto.split('<FIN>');
      bloques.forEach(b => {
        const q = b.match(/\$Pregunta:\s*([\s\S]*?)(?=\$Respuesta:)/);
        const r = b.match(/\$Respuesta:\s*([\s\S]*?)$/);
        if (q && r) datos[q[1].trim()] = r[1].trim();
      });
      return datos;
    }

    function normalizarTexto(t) {
      return t.toLowerCase().trim().replace(/\s*ylmia\s*/gi, '').trim();
    }

    function calcularOperacion(p) {
      let op = p.replace(/√ó/g, '*').replace(/√∑/g, '/');
      const m = op.match(/(-?\d+\.?\d*)\s*([\+\-\*\/])\s*(-?\d+\.?\d*)/);
      if (!m) return null;
      const [_, a, o, b] = m;
      const n1 = parseFloat(a), n2 = parseFloat(b);
      if (o === '/' && n2 === 0) return 'No se puede dividir entre cero';
      return `El resultado es: ${eval(`${n1}${o}${n2}`)}`;
    }

    async function obtenerClima(ciudad) {
      try {
        const res = await fetch(`https://wttr.in/${ciudad}?format=3&lang=es`);
        return res.ok ? await res.text() : null;
      } catch { return null; }
    }

    function obtenerHora() {
      return `La hora actual es ${new Date().toLocaleTimeString('es-ES')}`;
    }

    function obtenerFecha() {
      return `Hoy es ${new Date().toLocaleDateString('es-ES', { weekday:'long', year:'numeric', month:'long', day:'numeric' })}`;
    }

    async function obtenerConsejo() {
      try {
        const res = await fetch('https://api.adviceslip.com/advice');
        const data = await res.json();
        return data.slip.advice;
      } catch { return null; }
    }

    async function obtenerDatoCurioso() {
      try {
        const res = await fetch('https://uselessfacts.jsph.pl/random.json?language=en');
        const data = await res.json();
        return `Dato curioso: ${data.text}`;
      } catch { return null; }
    }

    async function obtenerResumenBusqueda(q) {
      try {
        const res = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(q)}&format=json`);
        const data = await res.json();
        return data.AbstractText || null;
      } catch { return null; }
    }

    function similitud(a, b) {
      a = normalizarTexto(a); b = normalizarTexto(b);
      let match = 0;
      for (let palabra of a.split(' ')) if (b.includes(palabra)) match++;
      return match / b.split(' ').length;
    }

    function buscarPorSimilitud(p) {
      let mejor = { clave: null, valor: 0 };
      for (let key in respuestasData) {
        const s = similitud(p, key);
        if (s > mejor.valor) mejor = { clave: key, valor: s };
      }
      return mejor.valor > 0.4 ? respuestasData[mejor.clave] : null;
    }

    async function procesarConsultasAPI(p) {
      const n = normalizarTexto(p);
      if (n.match(/clima|temperatura|tiempo.*en/i)) {
        const c = p.match(/en\s+(\w+)/i);
        if (c) return await obtenerClima(c[1]);
      }
      if (n.match(/qu√© hora|hora actual|dame la hora/i)) return obtenerHora();
      if (n.match(/qu√© d√≠a|fecha|d√≠a.*hoy|hoy.*es/i)) return obtenerFecha();
      if (n.match(/consejo|dame.*consejo|recomienda/i)) return await obtenerConsejo();
      if (n.match(/dato curioso|curiosidad|dato interesante/i)) return await obtenerDatoCurioso();
      return null;
    }

    async function buscarRespuesta(p) {
      const op = calcularOperacion(p);
      if (op) return op;
      const api = await procesarConsultasAPI(p);
      if (api) return api;
      const pn = normalizarTexto(p);
      for (let key in respuestasData) {
        if (normalizarTexto(key) === pn) return respuestasData[key];
      }
      const similar = buscarPorSimilitud(p);
      if (similar) return similar;
      const resumen = await obtenerResumenBusqueda(p);
      if (resumen) return resumen;
      return null;
    }

    function agregarMensaje(texto, tipo) {
      const chatbox = document.getElementById('chatbox');
      const m = document.createElement('div');
      m.className = `message ${tipo}-message`;
      m.innerHTML = tipo === 'loading'
        ? `<div class="text loading"><div class="spinner"></div><span>Procesando...</span></div>`
        : `<div class="text">${texto}</div>`;
      chatbox.appendChild(m);
      chatbox.scrollTop = chatbox.scrollHeight;
      return m;
    }

    async function sendMessage() {
      const input = document.getElementById('userInput');
      const q = input.value.trim();
      if (!q) return;
      agregarMensaje(q, 'user');
      input.value = '';
      const loading = agregarMensaje('', 'loading');
      await new Promise(r => setTimeout(r, 500));
      const resp = await buscarRespuesta(q);
      loading.remove();
      agregarMensaje(resp || 'Parece que hubo un error al contestar esta pregunta. M√°s info en https://yalmil.pages.dev/errors (Error-101 o 204)', resp ? 'bot' : 'error');
      guardarHistorial();
    }

    function guardarHistorial() {
      localStorage.setItem('chatHistory', document.getElementById('chatbox').innerHTML);
    }

    window.addEventListener('beforeunload', guardarHistorial);
    window.addEventListener('load', () => {
      const hist = localStorage.getItem('chatHistory');
      if (hist) document.getElementById('chatbox').innerHTML = hist;
    });

    document.getElementById('userInput').addEventListener('keypress', e => {
      if (e.key === 'Enter') sendMessage();
    });

    document.getElementById('sendButton').addEventListener('click', sendMessage);

    cargarRespuestas();
  </script>
</body>
  </html>
